import os

#TARGET = "Callisto"
#TARGET = "Ganymede"
TARGET= "Europa"

SCANS = [  # Callisto coordinates
    ("scan04", "2020-Dec-21 08:40", "J2000 20h10m00.94s -20d34m11.2s"),
    ("scan06", "2020-Dec-21 08:57", "J2000 20h10m01.50s -20d34m09.5s"),
    ("scan08", "2020-Dec-21 09:15", "J2000 20h10m02.10s -20d34m07.7s"),
    ("scan11", "2020-Dec-21 09:39", "J2000 20h10m02.89s -20d34m05.4s"),
    ("scan13", "2020-Dec-21 09:57", "J2000 20h10m03.49s -20d34m03.6s"),
    ("scan15", "2020-Dec-21 10:15", "J2000 20h10m04.08s -20d34m01.8s"),
    ("scan18", "2020-Dec-21 10:39", "J2000 20h10m04.88s -20d33m59.5s"),
    ("scan20", "2020-Dec-21 10:57", "J2000 20h10m05.47s -20d33m57.7s"),
    ("scan22", "2020-Dec-21 11:15", "J2000 20h10m06.06s -20d33m55.9s"),
    ("scan24", "2020-Dec-21 11:33", "J2000 20h10m06.66s -20d33m54.2s"),
    ("scan27", "2020-Dec-21 11:58", "J2000 20h10m07.48s -20d33m51.7s"),
    ("scan29", "2020-Dec-21 12:16", "J2000 20h10m08.07s -20d33m50.0s"),
    ("scan31", "2020-Dec-21 12:35", "J2000 20h10m08.69s -20d33m48.1s"),
    ("scan34", "2020-Dec-21 13:00", "J2000 20h10m09.51s -20d33m45.7s"),
    ("scan36", "2020-Dec-21 13:18", "J2000 20h10m10.10s -20d33m43.9s"),
    ("scan38", "2020-Dec-21 13:36", "J2000 20h10m10.69s -20d33m42.2s"),
    ("scan41", "2020-Dec-21 14:00", "J2000 20h10m11.48s -20d33m39.8s"),
    ("scan43", "2020-Dec-21 14:18", "J2000 20h10m12.07s -20d33m38.1s"),
    ("scan45", "2020-Dec-21 14:36", "J2000 20h10m12.66s -20d33m36.3s"),
    ("scan48", "2020-Dec-21 15:00", "J2000 20h10m13.44s -20d33m34.0s"),
    ("scan50", "2020-Dec-21 15:18", "J2000 20h10m14.03s -20d33m32.3s"),
    ("scan52", "2020-Dec-21 15:36", "J2000 20h10m14.61s -20d33m30.5s"),
    ("scan55", "2020-Dec-21 16:00", "J2000 20h10m15.40s -20d33m28.2s"),
    ("scan57", "2020-Dec-21 16:17", "J2000 20h10m15.95s -20d33m26.6s"),
    ("scan59", "2020-Dec-21 16:35", "J2000 20h10m16.53s -20d33m24.8s"),
    ("scan61", "2020-Dec-21 16:53", "J2000 20h10m17.12s -20d33m23.1s"),
    ("scan64", "2020-Dec-21 17:17", "J2000 20h10m17.90s -20d33m20.8s")
]

# REMAP = {  # ganymede
#     "2020-Dec-21 08:40": "J2000 20h09m48.03s -20d34m55.4s",
#     "2020-Dec-21 08:57": "J2000 20h09m48.53s -20d34m54.0s",
#     "2020-Dec-21 09:15": "J2000 20h09m49.07s -20d34m52.4s",
#     "2020-Dec-21 09:39": "J2000 20h09m49.78s -20d34m50.4s",
#     "2020-Dec-21 09:57": "J2000 20h09m50.31s -20d34m48.8s",
#     "2020-Dec-21 10:15": "J2000 20h09m50.84s -20d34m47.3s",
#     "2020-Dec-21 10:39": "J2000 20h09m51.55s -20d34m45.2s",
#     "2020-Dec-21 10:57": "J2000 20h09m52.07s -20d34m43.7s",
#     "2020-Dec-21 11:15": "J2000 20h09m52.60s -20d34m42.2s",
#     "2020-Dec-21 11:33": "J2000 20h09m53.13s -20d34m40.6s",
#     "2020-Dec-21 11:58": "J2000 20h09m53.86s -20d34m38.5s",
#     "2020-Dec-21 12:16": "J2000 20h09m54.38s -20d34m37.0s",
#     "2020-Dec-21 12:35": "J2000 20h09m54.93s -20d34m35.4s",
#     "2020-Dec-21 13:00": "J2000 20h09m55.66s -20d34m33.3s",
#     "2020-Dec-21 13:18": "J2000 20h09m56.18s -20d34m31.8s",
#     "2020-Dec-21 13:36": "J2000 20h09m56.70s -20d34m30.3s",
#     "2020-Dec-21 14:00": "J2000 20h09m57.39s -20d34m28.3s",
#     "2020-Dec-21 14:18": "J2000 20h09m57.90s -20d34m26.8s",
#     "2020-Dec-21 14:36": "J2000 20h09m58.42s -20d34m25.3s",
#     "2020-Dec-21 15:00": "J2000 20h09m59.11s -20d34m23.4s",
#     "2020-Dec-21 15:18": "J2000 20h09m59.63s -20d34m21.9s",
#     "2020-Dec-21 15:36": "J2000 20h10m00.14s -20d34m20.4s",
#     "2020-Dec-21 16:00": "J2000 20h10m00.82s -20d34m18.4s",
#     "2020-Dec-21 16:17": "J2000 20h10m01.31s -20d34m17.1s",
#     "2020-Dec-21 16:35": "J2000 20h10m01.82s -20d34m15.6s",
#     "2020-Dec-21 16:53": "J2000 20h10m02.33s -20d34m14.1s",
#     "2020-Dec-21 17:17": "J2000 20h10m03.01s -20d34m12.2s"
# }

REMAP = { # Europa
    "2020-Dec-21 08:40": "J2000 20h09m27.25s -20d36m13.4s",
    "2020-Dec-21 08:57": "J2000 20h09m27.88s -20d36m11.5s",
    "2020-Dec-21 09:15": "J2000 20h09m28.56s -20d36m09.5s",
    "2020-Dec-21 09:39": "J2000 20h09m29.47s -20d36m06.9s",
    "2020-Dec-21 09:57": "J2000 20h09m30.16s -20d36m04.8s",
    "2020-Dec-21 10:15": "J2000 20h09m30.85s -20d36m02.8s",
    "2020-Dec-21 10:39": "J2000 20h09m31.79s -20d36m00.1s",
    "2020-Dec-21 10:57": "J2000 20h09m32.50s -20d35m58.0s",
    "2020-Dec-21 11:15": "J2000 20h09m33.21s -20d35m55.9s",
    "2020-Dec-21 11:33": "J2000 20h09m33.93s -20d35m53.8s",
    "2020-Dec-21 11:58": "J2000 20h09m34.93s -20d35m50.8s",
    "2020-Dec-21 12:16": "J2000 20h09m35.66s -20d35m48.6s",
    "2020-Dec-21 12:35": "J2000 20h09m36.44s -20d35m46.3s",
    "2020-Dec-21 13:00": "J2000 20h09m37.47s -20d35m43.2s",
    "2020-Dec-21 13:18": "J2000 20h09m38.22s -20d35m41.0s",
    "2020-Dec-21 13:36": "J2000 20h09m38.97s -20d35m38.7s",
    "2020-Dec-21 14:00": "J2000 20h09m39.98s -20d35m35.7s",
    "2020-Dec-21 14:18": "J2000 20h09m40.74s -20d35m33.4s",
    "2020-Dec-21 14:36": "J2000 20h09m41.51s -20d35m31.1s",
    "2020-Dec-21 15:00": "J2000 20h09m42.55s -20d35m28.0s",
    "2020-Dec-21 15:18": "J2000 20h09m43.33s -20d35m25.6s",
    "2020-Dec-21 15:36": "J2000 20h09m44.11s -20d35m23.2s",
    "2020-Dec-21 16:00": "J2000 20h09m45.17s -20d35m20.0s",
    "2020-Dec-21 16:17": "J2000 20h09m45.92s -20d35m17.8s",
    "2020-Dec-21 16:35": "J2000 20h09m46.72s -20d35m15.3s",
    "2020-Dec-21 16:53": "J2000 20h09m47.53s -20d35m12.9s",
    "2020-Dec-21 17:17": "J2000 20h09m48.61s -20d35m09.6s",
}

for scan, utc, phasecenter in SCANS:
    source = '1608538564_sdp_l0-Jupiter-{}.ms'.format(scan)
    target = '1608538564_sdp_l0-{}-{}.ms'.format(TARGET, scan)
    os.system("rm -fr {}*".format(target))
    print("updating CORRECTED_DATA")
    os.system("taql update {} set CORRECTED_DATA=CORRECTED_DD_DATA-MODEL_DATA".format(source))
    print("splitting")
    split(vis=source, outputvis=target, datacolumn='corrected')
    if REMAP:
        phasecenter = REMAP[utc]
    _, ra, dec = phasecenter.split()
    os.system("chgcentre {} {} {}".format(target, ra, dec))
